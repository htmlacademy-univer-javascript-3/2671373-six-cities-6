import{r as i,j as s,L as b,u as P,a as L,b as C,c as F,g as M,d as k,e as w}from"./index-e1baedf7.js";import{c as p,L as z,O as A}from"./LoadingWrapper-3377959b.js";import{M as D}from"./Map-f23a8552.js";const _=["Paris","Cologne","Brussels","Amsterdam","Hamburg","Dusseldorf"],E={Amsterdam:{name:"Amsterdam",location:{latitude:52.3909553943508,longitude:4.85309666406198,zoom:13}},Brussels:{name:"Brussels",location:{latitude:50.847767,longitude:4.349394,zoom:13}},Cologne:{name:"Cologne",location:{latitude:50.935994,longitude:6.960506,zoom:13}},Dusseldorf:{name:"Dusseldorf",location:{latitude:51.2277411,longitude:6.7734556,zoom:13}},Hamburg:{name:"Hamburg",location:{latitude:53.55833,longitude:10.025,zoom:13}},Paris:{name:"Paris",location:{latitude:48.8534,longitude:2.3488,zoom:13}}},x=i.memo(t=>{const{active:a,locations:d}=t;return s.jsx("div",{className:"tabs",children:s.jsx("section",{className:"locations container",children:s.jsx("ul",{className:"locations__list tabs__list",children:d.map(o=>s.jsx("li",{className:"locations__item",children:s.jsx(b,{className:p("locations__item-link tabs__item",a===o&&"tabs__item--active"),to:`?city=${o}`,children:s.jsx("span",{children:o})})},o))})})})});x.displayName="LocationsList";const H=t=>{const[a,d]=i.useState(!1),{sorting:o,setSorting:m,options:n}=t;return s.jsxs("form",{className:"places__sorting",action:"#",method:"get",children:[s.jsx("span",{className:"places__sorting-caption",children:"Sort by"}),s.jsxs("span",{className:"places__sorting-type",tabIndex:0,onClick:()=>d(c=>!c),children:[o.value,s.jsx("svg",{className:"places__sorting-arrow",width:"7",height:"4",children:s.jsx("use",{xlinkHref:"#icon-arrow-select"})})]}),s.jsx("ul",{className:p("places__options places__options--custom",a&&"places__options--opened"),children:n.map(c=>s.jsx("li",{className:p("places__option",o.value===c.value&&"places__option--active"),tabIndex:0,onClick:()=>m(c),children:c.value},c.value))})]})},h=[{value:"Popular"},{value:"Price: low to high",compareFunc:(t,a)=>t.price-a.price},{value:"Price: high to low",compareFunc:(t,a)=>a.price-t.price},{value:"Top rated first",compareFunc:(t,a)=>a.rating-t.rating}],B=()=>{const[t]=P(),[a,d]=i.useState(h[0]),[o,m]=i.useState(),n=L(),c=C(),{offers:g,isLoading:v}=F(e=>e.offers),[l,j]=i.useState(t.get("city")||_[0]);i.useEffect(()=>{const e=t.get("city");e&&j(e)},[t]),i.useEffect(()=>{n(M())},[l,n]);const N=i.useCallback(async(e,u)=>{const f=(await n(k({id:e,favorite:u}))).payload;"status"in f&&f.status===401&&c("/login"),await n(w())},[n,c]),y=i.useCallback(e=>{if(!e){m(void 0);return}m({id:e.id,location:e.location})},[]),r=i.useMemo(()=>g[l]||[],[g,l]),S=i.useMemo(()=>a.compareFunc?[...r].sort((e,u)=>a.compareFunc(e,u)):[...r],[a,r]),O=i.useMemo(()=>r.map(e=>({id:e.id,location:e.location})),[r]);return s.jsx("div",{className:"page page--gray page--main",children:s.jsxs("main",{className:"page__main page__main--index",children:[s.jsx("h1",{className:"visually-hidden",children:"Cities"}),s.jsx(x,{locations:_,active:l}),s.jsx(z,{isLoading:v,children:s.jsx("div",{className:"cities",children:s.jsxs("div",{className:"cities__places-container container",children:[s.jsxs("section",{className:"cities__places places",children:[s.jsx("h2",{className:"visually-hidden",children:"Places"}),s.jsxs("b",{className:"places__found",children:[r.length," places to stay in ",l]}),s.jsx(H,{sorting:a,setSorting:d,options:h}),s.jsx("div",{className:"cities__places-list places__list tabs__content",children:s.jsx(A,{offers:S,changeFavoriteStatus:N,selectOffer:y})})]}),s.jsx("div",{className:"cities__right-section",children:s.jsx(D,{city:E[l],points:O,selectedPoint:o})})]})})})]})})},W=B;export{W as MainPage};
